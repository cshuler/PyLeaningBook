---
title: "WaterQuality_4Aug20"
author: "Mia Comeros"
date: "04/08/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

#read in library

```{r}

library(vegan)
library(readxl)
library(dplyr)
library(lattice)
library(psych)



```





```{r Water Quality - Nutrients}
library(vegan)
library(readxl)
library(dplyr)
wq <- read_excel("C:/Users/jc445340/Dropbox/James Cook University/Data/Chapter1_WaterQuality/WQ_4Aug20.xlsx",
    sheet = "Nutrients") 
wq.dat <- as.data.frame(wq)

View(wq.dat)

wq.dat$Location <- as.factor(wq.dat$Location)
wq.dat$`Watershed Type` <- as.factor(wq.dat$`Watershed_Type`)
wq.dat$Sampling_Month <- as.factor(wq.dat$`Sampling_Month`)

```
#filter by location (stream and reef flat)
```{r}

wq.flat <- wq.dat %>% filter(wq$Location=="Reef Flat")

wq.stream <- wq.dat %>% filter(wq$Location=="Stream")



```





#Explore Nutrient wq data
```{r}

library(lattice)
library(psych)

wq.dat1<- wq.dat[c(2:8)]

View(wq.dat1)


pairs.panels(wq.dat1, panel=panel.smooth,
        main="Bivariate plots with histograms and smooth curves")

#pairs without panel.hist and panel.cor

pairs(wq.dat1, panel=panel.smooth,
        main="Bivariate plots with histograms and smooth curves")


```
```{r}


wq.flat1 <- wq.dat1 %>% filter(wq$Location=="Reef Flat")

wq.stream1<- wq.dat1 %>% filter(wq$Location=="Stream")


View(wq.stream1)

```


#data transformation and standardization - STREAM
```{r}

stream.log<-log(wq.stream1)

hist(stream.log)

hist(wq.stream1)

shapiro.test(stream.log$`Total N µmol/L`)

shapiro.test(stream.log$`Total P µmol/L`) 

shapiro.test(stream.log$`Phosphate µmol/L`) 

shapiro.test(stream.log$`Silicate µmol/L`)

shapiro.test(stream.log$`N+N µmol/L`) #not normaly distributed p=<0.05

shapiro.test(stream.log$`Ammonia µmol/L`) #NA

shapiro.test(stream.log$`DIN µmol/L`) #not normally distrubted p=<0.05


#Standarization of nutrient variables

#center and scale = standardize the variables (z-scores)

stream.z<-decostand(stream.log, "standardize")

apply(stream.z, 2, mean) #means = 0
apply(stream.z, 2, sd) #standard deviations = 1

#Same standarsdization using the scale() function (which returns a matrix)
stream.z<-as.data.frame(scale(stream.log))

hist(stream.z)


##

stream.z1<-decostand(wq.stream1, "standardize")

apply(stream.z1, 2, mean) #means = 0
apply(stream.z1, 2, sd) #standard deviations = 1

#Same standarsdization using the scale() function (which returns a matrix)
stream.z1<-as.data.frame(scale(wq.stream1))


```





##PCA of nutrient data - STREAM

```{r}
stream.pca<-rda(stream.log, scale=TRUE)
stream.pca
summary(stream.pca)
summary(stream.pca, scaling=1)

#eigenvalues
(stream.eig<-stream.pca$CA$eig)

screeplot(stream.pca, bstick=TRUE, npcs=length(stream.pca$CA$eig))

```
#plot wq.pca
```{r}
#plots using biplot.rda

par(mfrow=c(1,2))
biplot(stream.pca, scaling=1, main="PCA - scaling 1")
biplot(stream.pca, main="PCA - scaling 2")

#Plots using cleanplot.pca
library(vegan)

#A rectangular graphic window is needed to draw the plots together
par(mfrow=c(1,2))
cleanplot.pca(stream.pca, scaling=1, mar.percent=0.08)



```
#making plot presentable
```{r}
#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(stream.pca, display = "sites"))

#add factors back into data frame 
data.scores$Season = wq.stream$Season
data.scores$Site = wq.stream$Site
data.scores$Transect = wq.stream$Transect
data.scores$Site_Transect = wq.stream$Site_Transect
data.scores$Location = wq.stream$Location
data.scores$Reef.Type = wq.stream$Reef.Type
data.scores$Watershed.severity = wq.stream$Watershed_Type
data.scores$Sampling.Month = wq.stream$Sampling_Month


 
head(data.scores)
```
##ggplot WQ Nutrients
```{r}

library(ggplot2)

xx = ggplot(data.scores, aes(x = PC1, y = PC2)) + 
    geom_point(size = 9, aes( shape = Site, colour = Watershed.severity))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Site")  + 
    scale_colour_manual(values = c("red", "black", "blue")) 
 
xx

```
#ggplot ---- more
```{r}
en = envfit(stream.pca, wq.stream, permutations = 1000, na.rm = TRUE)
en_coord_cont = as.data.frame(scores(en, "vectors"))

###############################JAKE COMMENT######################

#reduce vectors to those where p<0.05
A <- as.list(en$vectors) #creating the dataframe
pvals<-as.data.frame(A$pvals)
C<-cbind(en_coord_cont, pvals)
Cred<-subset(C,pvals<0.01)#subset to p<0.05 - CHANGE IF NEEDED
reduced.coord.cont <- cbind(Cred, Variables = rownames(Cred))


library(ggrepel) # to stop labels overlapping cange geom_text in the 4th line to geom_text_repel.

#e.g overlapping names

xx = ggplot(data.scores, aes(x = PC1, y = PC2)) + 
    geom_point(size = 7, aes( shape = Site, colour = Watershed.severity))+ 
    geom_segment(aes(x = 0, y = 0, xend = PC1, yend = PC2), data = reduced.coord.cont, size =0.1, alpha = 0.5, colour = "grey30")+
    geom_text(data = reduced.coord.cont, aes(x = PC1, y = PC2), colour = "grey30", fontface = "bold", label = row.names(reduced.coord.cont)) + 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank())+ 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Site")  + 
   scale_colour_manual(values = c("red", "black", "blue")) 

xx


##

xx = ggplot(data.scores, aes(x = PC1, y = PC2)) + 
    geom_point(size = 9, aes( shape = Site, colour = Watershed.severity))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Site")  + 
    scale_colour_manual(values = c("red", "black", "blue")) 
 




##

#non-overlapping - but less lined up with vectors
 
wq = ggplot(data.scores, aes(x = PC1, y = PC2)) + 
    geom_point(size = 6, aes( shape = Sampling.Month, colour = Watershed.severity))+
    geom_segment(aes(x = 0, y = 0, xend = PC1, yend = PC2), data = reduced.coord.cont, size =0.1, alpha = 0.5, colour = "grey30") +
    geom_text_repel(data = reduced.coord.cont, aes(x = PC1, y = PC2), colour = "grey30", fontface = "bold", label = row.names(reduced.coord.cont)) + 
    theme(axis.text.y = element_text(colour = "black", size = 10, face = "bold"), axis.text.x = element_text(colour = "black", face = "bold", size = 10), 
    legend.text = element_text(size = 10, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 12, colour = "black"), 
    legend.title = element_text(size = 12, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Watershed Type", y = "PC2", shape = "Sampling Month")  + 
   scale_colour_manual(values = c("#E69F00", "#009E73", "#9999CC"))


wq + scale_y_continuous(paste(names(stream.eig[2]),
                                  sprintf('(%0.1f%% explained var.)', 100* stream.eig[2]/sum(stream.eig))))+
  scale_x_continuous(paste(names(stream.eig[1]),
                           sprintf('(%0.1f%% explained var.)', 100* stream.eig[1]/sum(stream.eig)))) + ggtitle("Nutrients - Stream")
  
```
#Nutrients Reef Flat
```{r - Reef Flat Nutrients transformation and standardization}

flat.log<-log(wq.flat1)

hist(flat.log)

hist(wq.flat1)

shapiro.test(flat.log$`Total N µmol/L`)

shapiro.test(flat.log$`Total P µmol/L`) 

shapiro.test(flat.log$`Phosphate µmol/L`) 

shapiro.test(flat.log$`Silicate µmol/L`)

shapiro.test(flat.log$`N+N µmol/L`) 

shapiro.test(flat.log$`Ammonia µmol/L`) #NA

shapiro.test(flat.log$`DIN µmol/L`) #not normally distrubted p=<0.05


#Standarization of nutrient variables

#center and scale = standardize the variables (z-scores)

flat.z<-decostand(flat.log, "standardize")

apply(flat.z, 2, mean) #means = 0
apply(flat.z, 2, sd) #standard deviations = 1

#Same standarsdization using the scale() function (which returns a matrix)
flat.z<-as.data.frame(scale(flat.log))

hist(flat.z)


##

flat.z1<-decostand(wq.flat1, "standardize")

apply(flat.z1, 2, mean) #means = 0
apply(flat.z1, 2, sd) #standard deviations = 1

#Same standarsdization using the scale() function (which returns a matrix)
flat.z1<-as.data.frame(scale(wq.flat1))



```


#PCA nutrient data Reef Flat
```{r}
flat.pca<-rda(flat.log, scale=TRUE)
flat.pca
summary(flat.pca)
summary(flat.pca, scaling=1)

#eigenvalues
(flat.eig<-flat.pca$CA$eig)

screeplot(flat.pca, bstick=TRUE, npcs=length(flat.pca$CA$eig))

```
#Plot nutrients -Reef Flat pca
```{r}
#plots using biplot.rda

par(mfrow=c(1,2))
biplot(flat.pca, scaling=1, main="PCA - scaling 1")
biplot(flat.pca, main="PCA - scaling 2")

#Plots using cleanplot.pca
library(vegan)

#A rectangular graphic window is needed to draw the plots together
par(mfrow=c(1,2))
cleanplot.pca(stream.pca, scaling=1, mar.percent=0.08)

```
#make plots presentable - Nutrients Reef Flat
```{r}
#extract NMDS scores (x and y coordinates)
data.scores2 = as.data.frame(scores(flat.pca, display = "sites"))

#add factors back into data frame 
data.scores2$Season = wq.flat$Season
data.scores2$Site = wq.flat$Site
data.scores2$Transect = wq.flat$Transect
data.scores2$Site_Transect = wq.flat$Site_Transect
data.scores2$Location = wq.flat$Location
data.scores2$Reef.Type = wq.flat$Reef.Type
data.scores2$Watershed.severity = wq.flat$Watershed_Type
data.scores2$Sampling.Month = wq.flat$Sampling_Month


 
head(data.scores2)
```
#ggplot Nutrients Reef Flat
```{r}

library(ggplot2)

flat = ggplot(data.scores2, aes(x = PC1, y = PC2)) + 
    geom_point(size = 9, aes( shape = Site, colour = Watershed.severity))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Site")  + 
    scale_colour_manual(values = c("red", "black", "blue")) 
 
flat
```
#more ggplot Nutrients Reef FLat
```{r}
en = envfit(flat.pca, wq.flat, permutations = 1000, na.rm = TRUE)
en_coord_cont = as.data.frame(scores(en, "vectors"))

###############################JAKE COMMENT######################

#reduce vectors to those where p<0.05
A <- as.list(en$vectors) #creating the dataframe
pvals<-as.data.frame(A$pvals)
C<-cbind(en_coord_cont, pvals)
Cred<-subset(C,pvals<0.01)#subset to p<0.05 - CHANGE IF NEEDED
reduced.coord.cont <- cbind(Cred, Variables = rownames(Cred))


library(ggrepel) # to stop labels overlapping cange geom_text in the 4th line to geom_text_repel.

#e.g overlapping names

xx = ggplot(data.scores2, aes(x = PC1, y = PC2)) + 
    geom_point(size = 7, aes( shape = Site, colour = Watershed.severity))+ 
    geom_segment(aes(x = 0, y = 0, xend = PC1, yend = PC2), data = reduced.coord.cont, size =0.1, alpha = 0.5, colour = "grey30")+
    geom_text(data = reduced.coord.cont, aes(x = PC1, y = PC2), colour = "grey30", fontface = "bold", label = row.names(reduced.coord.cont)) + 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank())+ 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Site")  + 
   scale_colour_manual(values = c("red", "black", "blue")) 

xx


##

xx = ggplot(data.scores2, aes(x = PC1, y = PC2)) + 
    geom_point(size = 9, aes( shape = Site, colour = Watershed.severity))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Site")  + 
    scale_colour_manual(values = c("red", "black", "blue")) 
 




##

#non-overlapping - but less lined up with vectors
 
nut.flat = ggplot(data.scores2, aes(x = PC1, y = PC2)) + 
    geom_point(size = 6, aes( shape = Sampling.Month, colour = Watershed.severity))+
    geom_segment(aes(x = 0, y = 0, xend = PC1, yend = PC2), data = reduced.coord.cont, size =0.1, alpha = 0.5, colour = "grey30") +
    geom_text_repel(data = reduced.coord.cont, aes(x = PC1, y = PC2), colour = "grey30", fontface = "bold", label = row.names(reduced.coord.cont)) + 
    theme(axis.text.y = element_text(colour = "black", size = 10, face = "bold"), axis.text.x = element_text(colour = "black", face = "bold", size = 10), 
    legend.text = element_text(size = 10, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 12, colour = "black"), 
    legend.title = element_text(size = 12, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Watershed Type", y = "PC2", shape = "Sampling Month")  + 
   scale_colour_manual(values = c("#E69F00", "#009E73", "#9999CC"))


nut.flat + scale_y_continuous(paste(names(flat.eig[2]),
                                  sprintf('(%0.1f%% explained var.)', 100* flat.eig[2]/sum(flat.eig))))+
  scale_x_continuous(paste(names(flat.eig[1]),
                           sprintf('(%0.1f%% explained var.)', 100* flat.eig[1]/sum(flat.eig)))) + ggtitle("Nutrients - Reef Flat")
```
#Sediments####
```{r}
sed <- read_excel("C:/Users/jc445340/Dropbox/James Cook University/Data/Chapter1_WaterQuality/WQ_4Aug20.xlsx",
    sheet = "Sediments") 
sed.dat <- as.data.frame(sed)

View(sed.dat)


sed.dat$Watershed.Type <- factor(sed.dat$`Watershed.Type`, levels=c("Pristine", "Intermediate", "Disturbed"))
sed.dat$Season <- as.factor(sed.dat$`Season`)
sed.dat$Month_Deployed<- as.factor(sed.dat$`Month_Deployed`)



```


#ggplot stacked bar sediments
```{r}

stacked<-sed.dat[c(2, 4:7, 11, 12)]

View(stacked)

stacked$Month_Deployed<- as.factor(sed.dat$`Month_Deployed`)
stacked$Watershed.Type <- factor(sed.dat$`Watershed.Type`, levels=c("Pristine", "Intermediate", "Disturbed"))



#gather function####


library(dplyr)
#gather geochem composition into one column
geochem<-stacked %>% 
  gather(Composition, Percent, c(2:4))

View(geochem)


#Unite function#### DO NOT USE THIS

geochem2<-geochem %>% unite(stacked, Composition, Percent, sep=".")

View(geochem2)

#ok, now we have geochem composition in 1 column. So let's try to make a stacked bar plot


library(ggplot2)


geochem$Watershed.Type <- ordered(c("Pristine", "Intermediate", "Disturbed"))


p1 <-ggplot(geochem) +
 aes(x = Month_Deployed, fill = Composition, weight = Accumulation) +
 geom_bar() +
 scale_fill_hue() +
 theme_bw() + theme(axis.text.x=element_text(angle=45, hjust=1)) + 
 facet_wrap(vars(Watershed.Type), scales = "free_y")


p1




##Plot 2 

ggplot(geochem) +
 aes(x = Site, fill = Composition, weight = Accumulation) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2") +
 theme_bw() + theme(axis.text.x=element_text(angle=45, hjust=1)) +
 facet_wrap(vars(Month_Deployed), scales = "free_y")


#Plot 3 

ggplot(geochem) +
 aes(x = Watershed.Type, fill = Composition, weight = Accumulation) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2") +
 labs(y = "Sediment accumulation (kg/day)") +
 theme_bw() + theme(axis.text.x=element_text(angle=45, hjust=1)) + 
 facet_wrap(vars(Month_Deployed), scales = "free_y")



```









#explore sediment data
```{r}
library(lattice)
library(psych)

sed.dat1<- sed.dat[c(4:10)]

View(sed.dat1)


pairs.panels(sed.dat1, panel=panel.smooth,
        main="Bivariate plots with histograms and smooth curves")

#pairs without panel.hist and panel.cor

pairs(sed.dat1, panel=panel.smooth,
        main="Bivariate plots with histograms and smooth curves")


```
#transformation and standardization - Sediments
```{r}
sed.log<-log(sed.dat1)

hist(sed.log)

hist(sed.dat1)

shapiro.test(sed.log$`Organic_Content`)

shapiro.test(sed.log$`Carbonate_Content`) # not normally distributed

shapiro.test(sed.log$`Mineral_Content`) # not normally distributed

shapiro.test(sed.log$`Accumulation`) 

shapiro.test(sed.log$`D10`)  # not normally distributed

shapiro.test(sed.log$`D50`) 

shapiro.test(sed.log$`D90`)  #not normally distrubted p=<0.05


#Standarization of nutrient variables

#center and scale = standardize the variables (z-scores)

sed.z<-decostand(sed.log, "standardize")

apply(sed.z, 2, mean) #means = 0
apply(sed.z, 2, sd) #standard deviations = 1

#Same standarsdization using the scale() function (which returns a matrix)
sed.z<-as.data.frame(scale(sed.log))

hist(sed.z)

##

sed.z1<-decostand(sed.dat1, "standardize")


apply(sed.z1, 2, mean) #means = 0
apply(sed.z1, 2, sd) #standard deviations = 1

#Same standarsdization using the scale() function (which returns a matrix)
sed.z1<-as.data.frame(scale(sed.dat1))

```


#pca sediment data
```{r}
sed.pca<-rda(sed.log, scale=TRUE)
sed.pca
summary(sed.pca)
summary(sed.pca, scaling=1)

#eigenvalues
(sed.eig<-sed.pca$CA$eig)

screeplot(sed.pca, bstick=TRUE, npcs=length(sed.pca$CA$eig))
```
#make plots presentable
```{r}
#extract NMDS scores (x and y coordinates)
data.scores3 = as.data.frame(scores(sed.pca, display = "sites"))

#add factors back into data frame 
data.scores3$Season = sed.dat$Season
data.scores3$Site = sed.dat$Site
data.scores3$Watershed.severity = sed.dat$Watershed.Type
data.scores3$Sampling.Month = sed.dat$Month_Deployed


 
head(data.scores3)
```
#ggplot Sediments
```{r}

library(ggplot2)

sed = ggplot(data.scores3, aes(x = PC1, y = PC2)) + 
    geom_point(size = 9, aes( shape = Season, colour = Watershed.severity))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Watershed type")  + 
    scale_colour_manual(values = c("red", "black", "blue")) 
 
sed

```
##prettier ggplot sediments
```{r}
en = envfit(sed.pca, sed.dat1, permutations = 1000, na.rm = TRUE)
en_coord_cont = as.data.frame(scores(en, "vectors"))

###############################JAKE COMMENT######################

#reduce vectors to those where p<0.05
A <- as.list(en$vectors) #creating the dataframe
pvals<-as.data.frame(A$pvals)
C<-cbind(en_coord_cont, pvals)
Cred<-subset(C,pvals<0.05)#subset to p<0.05 - CHANGE IF NEEDED
reduced.coord.cont <- cbind(Cred, Variables = rownames(Cred))


library(ggrepel) # to stop labels overlapping cange geom_text in the 4th line to geom_text_repel.

#e.g overlapping names

xx = ggplot(data.scores3, aes(x = PC1, y = PC2)) + 
    geom_point(size = 7, aes( shape = Site, colour = Watershed.severity))+ 
    geom_segment(aes(x = 0, y = 0, xend = PC1, yend = PC2), data = reduced.coord.cont, size =0.1, alpha = 0.5, colour = "grey30")+
    geom_text(data = reduced.coord.cont, aes(x = PC1, y = PC2), colour = "grey30", fontface = "bold", label = row.names(reduced.coord.cont)) + 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank())+ 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Site")  + 
   scale_colour_manual(values = c("red", "black", "blue")) 

xx


##

xx = ggplot(data.scores3, aes(x = PC1, y = PC2)) + 
    geom_point(size = 9, aes( shape = Site, colour = Watershed.severity))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Location", y = "PC2", shape = "Site")  + 
    scale_colour_manual(values = c("red", "black", "blue")) 
 




##

#non-overlapping - but less lined up with vectors
 
sed = ggplot(data.scores3, aes(x = PC1, y = PC2)) + 
    geom_point(size = 6, aes( shape = Watershed.severity, colour = Site))+
    geom_segment(aes(x = 0, y = 0, xend = PC1, yend = PC2), data = reduced.coord.cont, size =0.1, alpha = 0.5, colour = "grey30") +
    geom_text_repel(data = reduced.coord.cont, aes(x = PC1, y = PC2), colour = "grey30", fontface = "bold", label = row.names(reduced.coord.cont)) + 
    theme(axis.text.y = element_text(colour = "black", size = 10, face = "bold"), axis.text.x = element_text(colour = "black", face = "bold", size = 10), 
    legend.text = element_text(size = 10, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 12, colour = "black"), 
    legend.title = element_text(size = 12, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "PC1", colour = "Site", y = "PC2", shape = "Watershed type")  + 
   scale_colour_manual(values = c("#E69F00", "#009E73", "#9999CC", "pink", "grey30", "green", "purple"))


sed + scale_y_continuous(paste(names(sed.eig[2]),
                                  sprintf('(%0.1f%% explained var.)', 100* sed.eig[2]/sum(sed.eig))))+
  scale_x_continuous(paste(names(sed.eig[1]),
                           sprintf('(%0.1f%% explained var.)', 100* sed.eig[1]/sum(sed.eig)))) + ggtitle("Sediments")
```








